┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                    HR MANAGEMENT SYSTEM - DATABASE SCHEMA (3NF)                               │
│                            PostgreSQL - Relational Database                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘


┌──────────────────┐
│   LOCATIONS     │  Sedi Aziendali
├─────────────────┤
│ PK id           │ SERIAL
│    address      │ VARCHAR(255)
│    city         │ VARCHAR(100)
│    country      │ VARCHAR(100)
│    postal_code  │ VARCHAR(20)
│    created_at   │ TIMESTAMP
│    updated_at   │ TIMESTAMP
└────────┬────────┘
         │ 1:N
         │
         ▼
┌──────────────────────────────────────────────────────────────────────────────────┐
│                              DEPARTMENTS                                         │
├──────────────────────────────────────────────────────────────────────────────────┤
│ PK id                     SERIAL                                                │
│    name                   VARCHAR(100)  UNIQUE                                  │
│ FK location_id            INTEGER       → locations.id                           │
│ FK manager_id             INTEGER       → employees.id                            │
│    budget                 DECIMAL(15,2)                                         │
│    description            TEXT                                                  │
│    created_at             TIMESTAMP                                             │
│    updated_at             TIMESTAMP                                             │
└────────┬────────────────────────────────────────────────────────────────────────┘
         │ 1:N
         │
         ▼
┌──────────────────────────────────────────────────────────────────────────────────┐
│                               EMPLOYEES                                         │
├──────────────────────────────────────────────────────────────────────────────────┤
│ PK id                          SERIAL                                          │
│    employee_number             VARCHAR(20)   UNIQUE                             │
│    first_name                  VARCHAR(50)                                      │
│    last_name                   VARCHAR(50)                                      │
│    email                       VARCHAR(100)  UNIQUE                             │
│    phone                       VARCHAR(20)                                      │
│    birth_date                  DATE                                            │
│    hire_date                   DATE                                            │
│    termination_date            DATE                                            │
│ FK job_id                     INTEGER       → jobs.id                            │
│ FK department_id              INTEGER       → departments.id                     │
│ FK manager_id                 INTEGER       → employees.id (SELF)               │
│    status                      VARCHAR(20)   CHECK(active,terminated...)        │
│    created_at                 TIMESTAMP                                             │
│    updated_at                 TIMESTAMP                                             │
└──────────────────────────────────────────────────────────────────────────────────┘
         │                                     │
         │                                     │ Self-reference (Hierarchy)
         │ 1:N                                 │ 1:N
         │                                     ▼
         │                          ┌─────────────────────┐
         │                          │    employees        │
         │                          │  (managers)         │
         │                          └─────────────────────┘
         │
         ├──────────────────────────────────────────────────────────────────────┐
         │                                                                      │
         │ 1:N                                     1:N                         │
         ▼                                       ▼                            ┌─────────────────────────────┐
┌─────────────────┐                    ┌──────────────────┐                    │        SALARIES            │
│    JOBS         │ 1:N                │    SALARIES      │ 1:N                ├─────────────────────────────┤
├─────────────────┤                    ├──────────────────┤                    │ PK id           SERIAL       │
│ PK id           │ SERIAL             │ PK id            │ SERIAL              │ FK employee_id  INTEGER     │
│    title        │ VARCHAR(100) UNIQUE │ FK employee_id   │ INTEGER             │    amount       DECIMAL(12,2)│
│    description  │ TEXT               │    amount        │ DECIMAL(12,2)       │    effective   DATE         │
│    min_salary   │ DECIMAL(12,2)      │    effective     │ DATE                │    end_date     DATE         │
│    max_salary   │ DECIMAL(12,2)      │    end_date      │ DATE                │    created     TIMESTAMP    │
│    created_at   │ TIMESTAMP          │    created       │ TIMESTAMP           │    CHECK: end >= effective   │
│    updated_at   │ TIMESTAMP          │    CHECK:        │                     └─────────────────────────────┘
└─────────────────┘                    │      end>=effective│                                    │
                                       └──────────────────┘                                    │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                          JOB_HISTORY                                             │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│ PK id                   SERIAL                                                 │   │
│ FK employee_id          INTEGER       → employees.id                             │   │
│    start_date           DATE                                                     │   │
│    end_date             DATE                                                     │   │
│ FK job_id               INTEGER       → jobs.id                                   │   │
│ FK department_id        INTEGER       → departments.id                            │   │
│    reason               VARCHAR(255)                                             │   │
│    created_at           TIMESTAMP                                               │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                       DEPENDENTS                                                │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│ PK id                   SERIAL                                                 │   │
│ FK employee_id          INTEGER       → employees.id                             │   │
│    first_name           VARCHAR(50)                                             │   │
│    last_name            VARCHAR(50)                                             │   │
│    relationship         VARCHAR(50)   CHECK(spouse,child,parent...)             │   │
│    birth_date           DATE                                                     │   │
│    created_at           TIMESTAMP                                               │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                       BENEFITS                                                  │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│ PK id                   SERIAL                                                 │   │
│ FK employee_id          INTEGER       → employees.id                             │   │
│    benefit_type         VARCHAR(50)   CHECK(health_insurance,dental...)         │   │
│    coverage_amount      DECIMAL(10,2)                                           │   │
│    cost                 DECIMAL(10,2)                                           │   │
│    enrollment_date      DATE                                                     │   │
│    created_at           TIMESTAMP                                               │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                    PERFORMANCE_REVIEWS                                          │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│ PK id                   SERIAL                                                 │   │
│ FK employee_id          INTEGER       → employees.id                             │   │
│ FK reviewer_id          INTEGER       → employees.id (cannot review self)       │   │
│    review_date          DATE                                                     │   │
│    rating               INTEGER       CHECK(1-5)                                │   │
│    comments             TEXT                                                     │   │
│    goals_met            VARCHAR(10)   CHECK(yes,no,partial,na)                  │   │
│    created_at           TIMESTAMP                                               │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                      ATTENDANCE                                                 │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│ PK id                   SERIAL                                                 │   │
│ FK employee_id          INTEGER       → employees.id                             │   │
│    attendance_date      DATE           UNIQUE(employee_id, date)                │   │
│    check_in             TIME                                                     │   │
│    check_out            TIME                                                     │   │
│    hours_worked         DECIMAL(4,2)                                           │   │
│    status               VARCHAR(20)   CHECK(present,absent,late...)             │   │
│    notes                TEXT                                                     │   │
│    created_at           TIMESTAMP                                               │   │
│    CHECK: checkout >= checkin                                                    │
│    CHECK: hours between 0-24                                                      │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                    SYSTEM TABLES (Automatic)                                     │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │   │
│  │          SALARY_AUDIT_LOG (Created by triggers)                         │    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤    │   │
│  │  PK id              SERIAL                                              │    │   │
│  │  FK employee_id     INTEGER      → employees.id                          │    │   │
│  │     old_salary       DECIMAL(12,2)                                      │    │   │
│  │     new_salary       DECIMAL(12,2)                                      │    │   │
│  │     change_amount    DECIMAL(12,2)                                      │    │   │
│  │     change_pct       DECIMAL(5,2)                                       │    │   │
│  │     reason           VARCHAR(255)                                       │    │   │
│  │     changed_by       VARCHAR(100)                                       │    │   │
│  │     change_date      TIMESTAMP                                         │    │   │
│  └─────────────────────────────────────────────────────────────────────────┘    │   │
│                                                                                   │   │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │   │
│  │       EMPLOYEE_STATUS_HISTORY (Status change tracking)                   │    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤    │   │
│  │  PK id              SERIAL                                              │    │   │
│  │  FK employee_id     INTEGER      → employees.id                          │    │   │
│  │     old_status       VARCHAR(20)                                        │    │   │
│  │     new_status       VARCHAR(20)                                        │    │   │
│  │     change_date      TIMESTAMP                                         │    │   │
│  │     changed_by       VARCHAR(100)                                       │    │   │
│  │     reason           TEXT                                              │    │   │
│  └─────────────────────────────────────────────────────────────────────────┘    │   │
│                                                                                   │   │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │   │
│  │     DEPARTMENT_STATISTICS (Auto-calculated metrics)                      │    │   │
│  ├─────────────────────────────────────────────────────────────────────────┤    │   │
│  │  PK id              SERIAL                                              │    │   │
│  │  FK department_id   INTEGER      → departments.id                         │    │   │
│  │     stat_date        DATE                                                │    │   │
│  │     headcount        INTEGER                                             │    │   │
│  │     active_count     INTEGER                                             │    │   │
│  │     total_salary     DECIMAL(15,2)                                       │    │   │
│  │     avg_salary       DECIMAL(12,2)                                       │    │   │
│  │     min_salary       DECIMAL(12,2)                                       │    │   │
│  │     max_salary       DECIMAL(12,2)                                       │    │   │
│  │     total_dependents INTEGER                                             │    │   │
│  └─────────────────────────────────────────────────────────────────────────┘    │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                            VIEWS (Pre-defined queries)                           │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│  • v_employee_details        - Complete employee information with joins          │   │
│  • v_salary_details         - Salary with job range comparison                   │   │
│  • v_attendance_summary     - Attendance statistics per employee                  │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                              INDEXES (Performance)                               │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│  Employees:                                                                     │   │
│    idx_employees_name          (last_name, first_name)                           │   │
│    idx_employees_email         (email)                                           │   │
│    idx_employees_department    (department_id)                                   │   │
│    idx_employees_job          (job_id)                                           │   │
│    idx_employees_manager       (manager_id)                                      │   │
│    idx_employees_status       (status)                                           │   │
│    idx_employees_hire_date    (hire_date)                                        │   │
│                                                                                  │   │
│  Salaries:                                                                      │   │
│    idx_salaries_employee      (employee_id)                                      │   │
│    idx_salaries_effective     (effective_date)                                   │   │
│    idx_salaries_active        (employee_id) WHERE end_date IS NULL (UNIQUE)      │   │
│                                                                                  │   │
│  Job History:                                                                  │   │
│    idx_job_history_employee   (employee_id)                                      │   │
│    idx_job_history_dates      (start_date, end_date)                             │   │
│                                                                                  │   │
│  Departments:                                                                  │   │
│    idx_departments_location   (location_id)                                      │   │
│    idx_departments_manager    (manager_id)                                       │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                           TRIGGERS (Automation)                                  │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│  1. trigger_salary_audit           → Logs all salary changes                      │   │
│  2. trigger_auto_update_dept       → Updates department manager automatically      │   │
│  3. trigger_salary_range           → Validates salary within job range            │   │
│  4. trigger_track_status           → Tracks employee status changes               │   │
│  5. trigger_validate_job_history    → Validates and normalizes job history          │   │
│  6. trigger_prevent_duplicate      → Prevents duplicate attendance records         │   │
│  7. trigger_update_dept_stats      → Auto-calculates department statistics        │   │
│  8. trigger_validate_benefit       → Validates benefit enrollment                │   │
│  9. trigger_validate_performance   → Validates performance reviews               │   │
│ 10. trigger_validate_dependent     → Validates dependent entries                   │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            │
┌──────────────────────────────────────────────────────────────────────────────────┐   │
│                           CONSTRAINTS (Data Integrity)                             │   │
├──────────────────────────────────────────────────────────────────────────────────┤   │
│  PRIMARY KEYS (PK):         13 tables                                             │   │
│  FOREIGN KEYS (FK):         15 relationships                                      │   │
│  UNIQUE CONSTRAINTS:        email, employee_number, department.name, job.title   │   │
│  CHECK CONSTRAINTS:         30+ validations (salary ranges, dates, status, etc.)   │
│  NOT NULL:                  All required fields                                     │   │
└──────────────────────────────────────────────────────────────────────────────────┘   │
                                                                                            │
                                                                                            ▼


KEY:
────
PK  = Primary Key
FK  = Foreign Key
1:N = One-to-Many relationship
→   = References/Points to


DATABASE METRICS:
─────────────────
• Total Tables:          13 (10 main + 3 system)
• Total Relationships:   15 foreign keys
• Total Triggers:        10 automation triggers
• Total Indexes:         20+ performance indexes
• Total Views:           3 materialized views
• Total Constraints:     45+ (PK, FK, UNIQUE, CHECK, NOT NULL)
• Total Sample Data:     500+ records


NORMALIZATION LEVEL: Third Normal Form (3NF)
✓ No repeating groups
✓ All non-key attributes depend on the primary key
✓ No transitive dependencies
✓ Fully normalized with proper referential integrity


Database Version: PostgreSQL 15+
Character Set: UTF-8
Created: 2024
